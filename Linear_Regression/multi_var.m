%% Extracting data
M = csvread('train.csv',0,0,[0 0 999 18]);
Mt = csvread('train.csv');
x1 = M(:,1);
x2 = M(:,2);
x3 = M(:,3);
x4 = M(:,4);
x5 = M(:,5);
x6 = M(:,6);
x7 = M(:,7);
x8 = M(:,8);
x9 = M(:,9);
x10 = M(:,10);
x11 = M(:,11);
x12 = M(:,12);
x13 = M(:,13);
x14 = M(:,14);
x15 = M(:,15);
x16 = M(:,16);
x17 = M(:,17);
x18 = M(:,18);
t = M(:,19);
xt1 = Mt(:,1);
xt2 = Mt(:,2);
xt3 = Mt(:,3);
xt4 = Mt(:,4);
xt5 = Mt(:,5);
xt6 = Mt(:,6);
xt7 = Mt(:,7);
xt8 = Mt(:,8);
xt9 = Mt(:,9);
xt10 = Mt(:,10);
xt11 = Mt(:,11);
xt12 = Mt(:,12);
xt13 = Mt(:,13);
xt14 = Mt(:,14);
xt15 = Mt(:,15);
xt16 = Mt(:,16);
xt17 = Mt(:,17);
xt18 = Mt(:,18);
tt = Mt(:,19);
x = [x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18];
xt = [xt1,xt2,xt3,xt4,xt5,xt6,xt7,xt8,xt9,xt10,xt11,xt12,xt13,xt14,xt15,xt16,xt17,xt18];

max_deg = 18;
%test_err = zeros(1,max_deg);
%tr_err = zeros(1,max_deg);
w_val = zeros(max_deg);

options = optimoptions(@fminunc,'Algorithm','quasi-newton');
%options = optimset('MaxFunEvals',40000);  
[w,fval] = fminunc(@(w)y(x,t,w,max_deg),zeros(1,max_deg),options);
tr_err= fval;
% b = zeros(1,0);
% w_val(max_deg,:) = [w,b];
test_err= calc_err(x,t,w,i);
figure('Name','Fitting');
plot(tt(2800:3000));
hold on;
res=transpose(val(xt,w,max_deg));
plot(res(2800:3000),'r');
mse=sum((t-(res)).^2)/length(t);
% abs_error = sum(abs(e1))/300;
% sq_error = sum(e1.^2)/300;
% rms_error  = sqrt(2*sum(e1.^2)/300);